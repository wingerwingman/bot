# CryptoBot TODO List
-------------------------------
do not delete this section.

- [x] **New Features & Improvements (Implemented 2026-01-28)**
    - **Telegram Ban Alerts (Item #4)**: Immediate notification for IP bans (-1003) even if no previous error was sent.
    - **ETH Balance Sync (Item #5)**: Fixed delay in updating ETH balance after purchase by adding immediate Binance refresh.
    - **Full Binance Balances (Item #6)**: Restored detailed asset table to dashboard (moved to bottom per request).
    - **Config Persistence (Item #7)**: Fixed manual overrides (Sentiment, ML, S/R, Order Book) to persist across page loads/restarts.
    - **Dashboard Sorting (Item #8)**: Paper bots are now sorted to the bottom of the list for better focus on live bots.
    - **Instant Balance Refresh (Item #9)**: Bot now force-refreshes balances immediately after every Buy/Sell for 100% accuracy.
    - **Extended Telegram Reports (Item #10)**: Added Weekly, Monthly, and Yearly automated performance reports.
    - **"Buy High" Analysis & Fix (Item #11)**: Tightened "Deep Dip" RSI threshold to 25% and added bypasses for MA cross in extreme conditions.


Updated: 2026-01-27
- [x] **Fix Paper Trading & Backtesting Status/Visibility (CRITICAL)**
    - Fixed "$---" market price display by ensuring `last_price` updates in all modes.
    - Resolved filtering in `App.js` to show Paper Trading bots in the Spot Bot tab.
    - Added mode badges (LIVE/PAPER/SIM) to Dashboard for visual clarity.
    - Fixed "not finding entry" bug by correcting Volume Confirmation logic.
    - Enabled Strategy Rejection Logs to show why trades are skipped in UI.
- [x] **Fix Spot Bot "Stopped" Status Discrepancy (CRITICAL)**
    - Fixed `NaN` (Not a Number) values in API response causing JSON parsing failures.
    - Implemented recursive JSON parsing in Frontend as a failsafe.
    - Standardized API status strings ("running"/"stopped").
- [x] **Add "Active Grid Matrix" to Dashboard**
    - Displays real-time Open Buy/Sell orders with price/qty for Grid Bots.
- [x] **Fix Bot Crash in Heartbeat Log**
    - Fixed `UnboundLocalError` related to `sl_price`.
    - Added `Value ($)` column to Control Panel Trade Journal table.
    - Shows Cost Basis (`entry_value`) for Sells to indicate original investment size.

- [x] **Fix duplicate/ghost bot appearing on start**
    - Updated ControlPanel to use correct `bot_key` (e.g. `live_ETHUSDT`) for selection ID.

- [x] **Improve Network Resilience (Grid Bot & Spot Bot)**
    - Added retry logic to `get_current_price` in Grid Bot to handle `NameResolutionError` and timeouts.
    - Throttled error logs for network issues to prevent spam.
    - **Added Critical Kill Switch for IP Bans (Error -1003)**: Bots will auto-stop and Server will pause polling to prevent extending bans.
    - **Parse Ban Duration**: Bot detects `until <timestamp>` in ban message and displays "Ban Lifted At: YYYY-MM-DD HH:MM:SS" in logs/alerts.
    - **Detailed Waiting Status**: Spot Bot now displays exact strategy rejection reason (e.g. "RSI too high: 45 > 30") instead of generic "Waiting...".


## üîµ TESTING & VERIFICATION

## üîÆ FUTURE ROADMAP
*Roadmap moved to IMPROVEMENTS.md for consolidation.*

## üìÅ FILES MODIFIED THIS SESSION
- `modules/indicators.py` - Fixed ATR Calculation
- `modules/trading_bot.py` - Atomic save_state, removed inline import
- `modules/server.py` - Fixed bug in metrics
- `botfrontend/src/` - Refactored API_BASE to config.js
- `botfrontend/src/components/*.js` - Updated for config.js
- `FIXES.md` - Updated

## ‚úÖ COMPLETED

### High Priority
‚úÖ All Advanced Filters, Volatility Spacing, and Resume Session are now adjustable while running.
‚úÖ Warning Alerts (Low balance, loss streaks, crashes) implemented.
- [x] **Add "Paper Trading Mode" (Item 30)**
    - Backend: Updated `server.py` to allow simulated trading without a backtest file.
    - Frontend: Added "Paper Trading" vs "Backtest" toggle in Control Panel (Test Mode).
    - Status: Returns `is_paper` flag to distinguish modes.

- [x] **Adjustable Advanced Strategy & Volatility Filters (Item #20 & #4)**
    - *Status: Fix implementation completed for both Spot and Grid bots. Awaiting user verification.*
- [x] **Backtest Analytics Upgrade**
    - Added Sharpe Ratio, Profit Factor, and Full Trade Journal (In-Memory) for backtests/paper trading.
- [x] **Streak Tracking Visible on Dashboard (Main Page)**
    - Frontend: Added "üî• Max Win Streak" and "üßä Max Loss Streak" to `LiveDashboard.js` and `ControlPanel.js`.

- [x] Fix state on spot bot (Dashboard Isolation)
    - Ensure Test bots don't appear on Live Dashboard.
    - Ensure Backtest Panel correctly identifies bots.
    - (The "second instance" issue should be resolved by correct ID-based lookups implemented in previous session and verified here).

- [x] Added PAUSE button on spot bot
- [x] Added PAUSE button on grid bot
- [x] Fix add bot to work with allocation slider
- [x] Fix logs - throttling
- [x] Separate activity and strategy clear buttons
- [x] Center bot icons

### Code Review & Refactoring
- [x] **Critical: Fix ATR Calculation Bug**
    - Fixed division by `period` instead of `num_bars` in `indicators.py`.
- [x] **Critical: Fix Race Condition in State Persistence**
    - Implemented atomic file writing (write-temp-rename) in `trading_bot.py` `save_state`.
- [x] **Refactor: Centralize Frontend Config**
    - Moved `API_BASE` to `botfrontend/src/config.js` and updated all components.
- [x] **Refactor: Remove Inline Imports**
    - Cleaned up imports in `modules/strategy.py`.
- [x] **Bug: Fix Server Metrics Error**
    - Fixed potential `NameError` in `server.py` `get_metrics`.
