# CryptoBot TODO List
-------------------------------
do not delete this section.
set bot to start backup after the ban has been lifted if ban error happened.also need to get allerts to telegram if bot is stopped due to ban and no error sent for the ban error also.
Updated: 2026-01-27
- [x] **Fix Spot Bot "Stopped" Status Discrepancy (CRITICAL)**
    - Fixed `NaN` (Not a Number) values in API response causing JSON parsing failures.
    - Implemented recursive JSON parsing in Frontend as a failsafe.
    - Standardized API status strings ("running"/"stopped").
- [x] **Add "Active Grid Matrix" to Dashboard**
    - Displays real-time Open Buy/Sell orders with price/qty for Grid Bots.
- [x] **Fix Bot Crash in Heartbeat Log**
    - Fixed `UnboundLocalError` related to `sl_price`.
    - Added `Value ($)` column to Control Panel Trade Journal table.
    - Shows Cost Basis (`entry_value`) for Sells to indicate original investment size.

- [x] **Fix duplicate/ghost bot appearing on start**
    - Updated ControlPanel to use correct `bot_key` (e.g. `live_ETHUSDT`) for selection ID.

- [x] **Improve Network Resilience (Grid Bot & Spot Bot)**
    - Added retry logic to `get_current_price` in Grid Bot to handle `NameResolutionError` and timeouts.
    - Throttled error logs for network issues to prevent spam.
    - **Added Critical Kill Switch for IP Bans (Error -1003)**: Bots will auto-stop and Server will pause polling to prevent extending bans.
    - **Parse Ban Duration**: Bot detects `until <timestamp>` in ban message and displays "Ban Lifted At: YYYY-MM-DD HH:MM:SS" in logs/alerts.
    - **Detailed Waiting Status**: Spot Bot now displays exact strategy rejection reason (e.g. "RSI too high: 45 > 30") instead of generic "Waiting...".



- [x] **Max win/loss streak stats not updating**
    - Logic for streak calculation refined in `trading_bot.py`.
- [x] **Backtest Bot Name Fix**
    - Correctly displays selected pair (e.g. SOLUSDT) instead of default ETHUSDT when starting backtest.

## üü° MEDIUM PRIORITY (Remaining)
- [ ] Fix manual_sell on Grid Bot (currently only Spot)
- [ ] Add "Sell Now" button to Grid Bot Panel
- [ ] Implement "Daily Loss Limit" (Risk Management)
- [ ] Sentiment Analysis (Future)

## üìÅ FILES MODIFIED THIS SESSION
- `modules/indicators.py` - Fixed ATR Calculation
- `modules/trading_bot.py` - Atomic save_state, removed inline import
- `modules/server.py` - Fixed bug in metrics
- `botfrontend/src/` - Refactored API_BASE to config.js
- `botfrontend/src/components/*.js` - Updated for config.js
- `FIXES.md` - Updated

## ‚úÖ COMPLETED

### High Priority
‚úÖ All Advanced Filters, Volatility Spacing, and Resume Session are now adjustable while running.
‚úÖ Warning Alerts (Low balance, loss streaks, crashes) implemented.
- [x] **Add "Paper Trading Mode" (Item 30)**
    - Backend: Updated `server.py` to allow simulated trading without a backtest file.
    - Frontend: Added "Paper Trading" vs "Backtest" toggle in Control Panel (Test Mode).
    - Status: Returns `is_paper` flag to distinguish modes.

- [x] **Adjustable Advanced Strategy & Volatility Filters (Item #20 & #4)**
    - *Status: Fix implementation completed for both Spot and Grid bots. Awaiting user verification.*
- [x] **Backtest Analytics Upgrade**
    - Added Sharpe Ratio, Profit Factor, and Full Trade Journal (In-Memory) for backtests/paper trading.
- [x] **Streak Tracking Visible on Dashboard (Main Page)**
    - Frontend: Added "üî• Max Win Streak" and "üßä Max Loss Streak" to `LiveDashboard.js` and `ControlPanel.js`.

- [x] Fix state on spot bot (Dashboard Isolation)
    - Ensure Test bots don't appear on Live Dashboard.
    - Ensure Backtest Panel correctly identifies bots.
    - (The "second instance" issue should be resolved by correct ID-based lookups implemented in previous session and verified here).

- [x] Added PAUSE button on spot bot
- [x] Added PAUSE button on grid bot
- [x] Fix add bot to work with allocation slider
- [x] Fix logs - throttling
- [x] Separate activity and strategy clear buttons
- [x] Center bot icons

### Code Review & Refactoring
- [x] **Critical: Fix ATR Calculation Bug**
    - Fixed division by `period` instead of `num_bars` in `indicators.py`.
- [x] **Critical: Fix Race Condition in State Persistence**
    - Implemented atomic file writing (write-temp-rename) in `trading_bot.py` `save_state`.
- [x] **Refactor: Centralize Frontend Config**
    - Moved `API_BASE` to `botfrontend/src/config.js` and updated all components.
- [x] **Refactor: Remove Inline Imports**
    - Cleaned up imports in `modules/strategy.py`.
- [x] **Bug: Fix Server Metrics Error**
    - Fixed potential `NameError` in `server.py` `get_metrics`.
